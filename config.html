<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" href="css/config.css">
</head>

<body class="down">

<div id="content">
    <div id="up-text">
        <h1>Session #<span id="session-id"></span></h1>
        <p id="session-time"></p>
    </div>

    <div id="down-text">
        <h1>Down Time</h1>
    </div>
</div>

<footer>

</footer>

<script>
    const {ipcRenderer} = require('electron')

    let interval = 0

    const seconds2hours = (sec) => {
        let h = ~~(sec / 3600)
        sec -= h * 3600
        let min = ~~(sec / 60)
        sec -= min * 60

        return [h, min, sec].map((x) => (x < 10 ? "0" : "") + x).join(':')
    }

    const updateTimer = (lastUp) => {
        const delta = ~~((+new Date() - lastUp) / 1000)
        document.getElementById('session-time').innerHTML = seconds2hours(delta)
    }

    ipcRenderer.on('status', (ev, data) => {
        clearInterval(interval)

        if (data.up) {
            document.body.className = "up"
            document.getElementById('session-id').innerHTML = data.sessionId

            updateTimer(data.lastUp)
            interval = setInterval(() => {
                updateTimer(data.lastUp)
            }, 1000)
        } else {
            document.body.className = "down"
        }
    })
</script>

</body>
</html>
